# Enhanced Prompt

**ID**: 1529b5cd-d7c6-4e59-9f0f-dec07391e259
**Version**: 1.0.0
**Workflow Type**: testing
**Score**: 100/100
**Created**: 2025-09-05T17:48:55.614Z
**Updated**: 2025-09-05T17:48:55.614Z

## Instruction

Implement comprehensive unit and integration tests for the `prompt-enhancer` package, focusing on robust mocking of external dependencies and a clear strategy for managing test data. Specifically, you must:

1.  **Create/Complete Tests**: Develop new tests and complete any unfinished examples within the `prompt-enhancer` package, ensuring full test coverage for its functionality.
2.  **Stub External Calls**: All external network calls made by the `prompt-enhancer` must be stubbed or mocked to prevent any actual outbound requests during test execution. This ensures test isolation and reliability.
3.  **Manage Response Payloads**: Capture actual response payloads from external APIs and store them as static fixtures in a dedicated folder within the `prompt-enhancer` package (e.g., `packages/prompt-enhancer/tests/fixtures/`). These fixtures will be used by the tests to simulate external API responses.
4.  **Automate Payload Capture**: Create a reusable script or utility that can automatically fetch the latest actual response data from external APIs and save it to the designated fixtures folder. This script should be run whenever the `prompt-enhancer`'s code (especially its external interactions) changes, to keep test data current.
5.  **Document Testing Strategy**: Update the `packages/prompt-enhancer/CLAUDE.md` file with clear, specific instructions and guidelines for this new testing and mocking strategy, including how to use the payload capture mechanism and maintain the test fixtures.

**Project Rules and Standards to Adhere To:**

- **Testing Framework**: Utilize Bun's built-in test runner. Tests should reside alongside source files or in a `tests/` directory within the `prompt-enhancer` package (`*.test.ts`).
- **Mocking**: Mock external APIs to avoid dependencies and ensure tests use `cleanupTestDb()` for isolation (if applicable, though unlikely for a prompt enhancer).
- **Documentation**: The `packages/prompt-enhancer/CLAUDE.md` file is the correct location for package-specific agent instructions and can be directly updated. Ensure documentation is kept with the code and updated immediately when functionality changes. Clean up any WIP files related to this task.
- **Coding Standards**: Adhere to TypeScript standards, including: no `any` type (use `unknown` instead), `"strict": true`, proper type guards, absolute imports (`@workspace/package/path`), and inline interfaces for function parameters. Follow naming conventions: kebab-case for files/directories, camelCase for functions, PascalCase for types/interfaces.
- **Development Workflow**: After implementing changes, run `bun dev`, `bun typecheck`, `bun test`, and `bun lint` to verify integration, types, tests, and code quality. Address all output issues.
- **Project Architecture**: Ensure new files are placed in appropriate package directories, maintaining modularity and single responsibility principle. Tests should follow the AAA (Arrange, Act, Assert) pattern.
- **Security**: While not directly altering production code, be mindful of any potential security implications when handling actual response payloads, ensuring they don't contain sensitive information that shouldn't be committed (though for test fixtures, this is less common).

## Context

**Project Overview**: AI Dr. workflow orchestration system
**Technical Stack**: TypeScript, Bun

### Relevant Files

- `packages/prompt-enhancer/src/**/*.ts`: File: packages/prompt-enhancer/src/\*_/_.ts
- `packages/prompt-enhancer/tests/**/*.test.ts`: File: packages/prompt-enhancer/tests/\*_/_.test.ts
- `packages/prompt-enhancer/CLAUDE.md`: File: packages/prompt-enhancer/CLAUDE.md
- `packages/prompt-enhancer/package.json`: File: packages/prompt-enhancer/package.json
- `packages/prompt-enhancer/scripts/capture-payloads.ts`: File: packages/prompt-enhancer/scripts/capture-payloads.ts
- `packages/prompt-enhancer/tests/fixtures/`: File: packages/prompt-enhancer/tests/fixtures/

### Dependencies

- @intellectronica/ruler
- @types/bun
- @types/minimatch
- @workspace/eslint-config
- @workspace/typescript-config
- minimatch
- prettier
- turbo
- typescript

## Success Criteria

1. ✅ All existing and newly created tests for the `prompt-enhancer` package pass successfully using `bun test`.
2. ✅ The test suite for `prompt-enhancer` makes no actual outbound network requests; all external calls are successfully stubbed/mocked.
3. ✅ Actual response payloads from external APIs are stored in a new, appropriately named directory within the `prompt-enhancer` package (e.g., `packages/prompt-enhancer/tests/fixtures/`).
4. ✅ A reusable script or utility (e.g., `packages/prompt-enhancer/scripts/capture-payloads.ts`) exists and correctly fetches/saves external API response payloads for test fixtures.
5. ✅ The `packages/prompt-enhancer/CLAUDE.md` file is updated with clear, comprehensive documentation on the test mocking strategy and the payload capture mechanism.
6. ✅ All new or modified code adheres to TypeScript strictness (`no any`, proper types, absolute imports) and passes `bun typecheck`.
7. ✅ All new or modified code adheres to project coding style guidelines (kebab-case for files, camelCase for functions) and passes `bun lint`.
8. ✅ The test structure follows the AAA (Arrange, Act, Assert) pattern where applicable.

## Constraints

- ⚠️ Use Bun's built-in test runner for all tests.
- ⚠️ Strictly prevent any actual outbound network calls during test execution; all external interactions must be mocked.
- ⚠️ Store actual external API response payloads as static JSON or similar fixtures for testing.
- ⚠️ Develop a reusable script for capturing and updating test fixtures that can be triggered manually or via a `package.json` script.
- ⚠️ The documentation for this testing and mocking strategy must be added to `packages/prompt-enhancer/CLAUDE.md`.
- ⚠️ All new code must be type-safe (no `any` type) and adhere to TypeScript standards (e.g., strict null checks, absolute imports).
- ⚠️ Adhere to project coding style guidelines (kebab-case for files, camelCase for functions, PascalCase for types).
- ⚠️ Tests should be co-located with their source files or in a dedicated `tests/` directory within the `prompt-enhancer` package.
- ⚠️ Ensure `bun typecheck`, `bun test`, and `bun lint` pass without errors after all changes.
- ⚠️ Do not modify the globally generated `CLAUDE.md` file; only update the package-specific `packages/prompt-enhancer/CLAUDE.md`.

## Clarifying Questions

1. ❓ What specific external APIs or services does the `prompt-enhancer` package interact with?
2. ❓ What are the expected data structures or schemas for the responses from these external APIs?
3. ❓ Should the payload capture script be a dedicated `bun` script or integrated as a utility within the `prompt-enhancer` package?
4. ❓ Are there any sensitive data considerations for the actual response payloads that need to be redacted or handled specially before saving as fixtures?

## Expected Output

**Format**: structured_data
**Structure**: Structured output

## Inputs

- **Original Prompt** (text): help me create tests for prompt enhancer and complete the ones that are there already with unfinished examples. It would be great if we can add stubs for external calls and prevent outbound calls altogether, but we should make sure we copy the actual response payload that we would expect to get into a proper folder and use those. The method to get the actual response data and save it for specs to use should be reusable and done when code for prompt enhancer changes, we need to add this to a rules file inside of the prompt-enhancer package, in CLAUDE.md there.

## Validation

**Status**: ✅ Valid
**Score**: 100/100

---

_Generated by AI Dr. Prompt Enhancer_
_This prompt includes comprehensive project rules and coding standards for self-contained execution_
